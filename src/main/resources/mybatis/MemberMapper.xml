<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zerobase.fastlms.admin.mapper.MemberMapper">

    <select id="selectListCount"
            parameterType="com.zerobase.fastlms.admin.model.MemberParam"
            resultType="long">
        SELECT
            COUNT(*)
        FROM MEMBER
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="searchType != null and searchValue != null">
                <choose>
                    <when test="searchType == 'userId'">
                        AND USER_ID LIKE CONCAT('%', #{searchValue}, '%')
                    </when>
                    <when test="searchType == 'userName'">
                        AND USER_NAME LIKE CONCAT('%', #{searchValue}, '%')
                    </when>
                    <when test="searchType == 'phone'">
                        AND PHONE LIKE CONCAT('%', #{searchValue}, '%')
                    </when>
                    <otherwise>
                        AND (
                        USER_ID LIKE CONCAT('%', #{searchValue}, '%')
                        OR
                        USER_NAME LIKE CONCAT('%', #{searchValue}, '%')
                        OR
                        PHONE LIKE CONCAT('%', #{searchValue}, '%')
                        )
                    </otherwise>
                </choose>
            </if>
        </trim>
    </select>


    <select id="selectList"
            parameterType="com.zerobase.fastlms.admin.model.MemberParam"
            resultType="com.zerobase.fastlms.admin.dto.MemberDto">
        SELECT
            user_id AS userId
            , password AS password
            , reg_dt AS regDt
            , user_name AS userName
            , phone AS phone
            , email_auth_key AS emailAuthKey
            , email_auth_yn AS emailAuthYn
            , email_auth_dt AS emailAuthDt
            , reset_password_key AS resetPasswordKey
            , reset_password_limit_dt AS resetPasswordLimitDt
            , admin_yn AS adminYn
        FROM MEMBER
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="searchType != null and searchValue != null">
                <choose>
                    <when test="searchType == 'userId'">
                        AND USER_ID LIKE CONCAT('%', #{searchValue}, '%')
                    </when>
                    <when test="searchType == 'userName'">
                        AND USER_NAME LIKE CONCAT('%', #{searchValue}, '%')
                    </when>
                    <when test="searchType == 'phone'">
                        AND PHONE LIKE CONCAT('%', #{searchValue}, '%')
                    </when>
                    <otherwise>
                        AND (
                            USER_ID LIKE CONCAT('%', #{searchValue}, '%')
                            OR
                            USER_NAME LIKE CONCAT('%', #{searchValue}, '%')
                            OR
                            PHONE LIKE CONCAT('%', #{searchValue}, '%')
                        )
                    </otherwise>
                </choose>
            </if>
        </trim>
        LIMIT #{pageStart}, #{pageEnd}
    </select>


</mapper>